# Configurações para ambiente LOCAL com PostgreSQL
# Para usar este perfil: mvn spring-boot:run -Dspring.profiles.active=local

spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/cca_local
    username: ${DB_USERNAME:cca_user}
    password: ${DB_PASSWORD:cca_password}
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 3
      connection-timeout: 20000
      idle-timeout: 600000
      max-lifetime: 1800000
  
  jpa:
    hibernate:
      ddl-auto: update  # Permite alterações automáticas para desenvolvimento local
    show-sql: true
    properties:
      hibernate:
        '[format_sql]': true
        '[use_sql_comments]': true
        '[generate_statistics]': false
    database-platform: org.hibernate.dialect.PostgreSQLDialect
  
  # H2 Console desabilitado (usando PostgreSQL)
  h2:
    console:
      enabled: false
  
  # DevTools habilitado para desenvolvimento
  devtools:
    restart:
      enabled: true
    livereload:
      enabled: true
  
  # Cache desabilitado para desenvolvimento
  cache:
    type: none
  
  # Flyway habilitado para migrations
  flyway:
    enabled: true
    baseline-on-migrate: true
    validate-on-migrate: true
    locations: classpath:db/migration
  
  # Inicialização do banco com dados de desenvolvimento
  sql:
    init:
      mode: always  # Executar scripts data.sql
      data-locations: classpath:data.sql
      continue-on-error: false

# Logging detalhado para desenvolvimento local
logging:
  level:
    root: INFO
    '[org.springframework.security]': DEBUG
    '[org.springframework.web]': DEBUG
    '[com.caracore.cca]': DEBUG
    '[org.hibernate.SQL]': DEBUG
    '[org.hibernate.type.descriptor.sql.BasicBinder]': TRACE
    '[USER_ACTIVITY]': INFO
  
# Swagger habilitado para desenvolvimento local
springdoc:
  swagger-ui:
    enabled: true
    try-it-out-enabled: true
  api-docs:
    enabled: true

# Configurações específicas da aplicação para desenvolvimento local
cca:
  ambiente: local
  debug-mode: true
  mock-external-services: false  # Usar serviços reais para testes locais
  whatsapp:
    api-url: ${WHATSAPP_API_URL:http://localhost:3000/api}
    api-key: ${WHATSAPP_API_KEY:local-test-key}
    enabled: ${WHATSAPP_ENABLED:true}
  email:
    smtp:
      host: ${SMTP_HOST:localhost}
      port: ${SMTP_PORT:1025}  # MailHog ou similar para desenvolvimento
      username: ${SMTP_USERNAME:test}
      password: ${SMTP_PASSWORD:test}
    from: ${EMAIL_FROM:noreply@local.dev}
  security:
    jwt:
      secret: ${JWT_SECRET:local-development-secret-key-change-in-production}
      expiration: 86400000  # 24 horas

# Configurações do servidor para desenvolvimento local
server:
  port: ${SERVER_PORT:8080}
  servlet:
    session:
      timeout: 60m  # 1 hora para desenvolvimento
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain,text/css,application/javascript

# Monitoramento e métricas para desenvolvimento
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,env,configprops,beans
  endpoint:
    health:
      show-details: always  # Mostrar detalhes de saúde em desenvolvimento
  info:
    env:
      enabled: true
