# Configurações para ambiente de TESTES
spring:
  datasource:
    url: jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password: 
    driver-class-name: org.h2.Driver
  
  jpa:
    hibernate:
      ddl-auto: create-drop  # Recria o banco a cada execução de teste
    show-sql: false  # Desabilitado para não poluir logs de teste
    properties:
      hibernate:
        '[format_sql]': false
        '[use_sql_comments]': false
        '[generate_statistics]': false
    database-platform: org.hibernate.dialect.H2Dialect
  
  h2:
    console:
      enabled: false  # Desabilitado em testes automatizados
  
  # SQL initialization
  sql:
    init:
      mode: never  # Evita execução dupla de scripts
  
  # Cache desabilitado para testes
  cache:
    type: none

  web:
    locale: pt_BR
    locale-resolver: fixed
  mvc:
    log-resolved-exception: true
    format:
      date: yyyy-MM-dd
      time: HH:mm:ss
      date-time: yyyy-MM-dd'T'HH:mm:ss
    message-codes-resolver-format: POSTFIX_ERROR_CODE
    contentnegotiation:
      favor-parameter: false
      media-types:
        json: application/json;charset=UTF-8
        html: text/html;charset=UTF-8
        plain: text/plain;charset=UTF-8

# Logging mínimo para testes
logging:
  level:
    root: WARN
    '[org.springframework.security]': WARN
    '[org.springframework.web]': WARN
    '[com.caracore.cca]': INFO
    '[org.hibernate.SQL]': WARN
    '[USER_ACTIVITY]': INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} %-5level %logger{36} - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} %-5level %logger{36} - %msg%n"

# Swagger desabilitado para testes
springdoc:
  swagger-ui:
    enabled: false
  api-docs:
    enabled: false

# Configurações do servidor para testes
server:
  port: 0  # Porta aleatória para evitar conflitos
  servlet:
    session:
      timeout: 5m  # Timeout menor para testes
    encoding:
      charset: UTF-8
      enabled: true
      force: true
  error:
    include-message: always
    include-binding-errors: always
